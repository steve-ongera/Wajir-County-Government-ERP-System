{% extends 'admin_base.html' %}
{% load humanize %}
{% load static %}

{% block title %}Roles - Admin{% endblock %}

{% block extra_css %}
<style>
    .breadcrumb {
        padding: 0;
        margin-bottom: 20px;
        font-size: 14px;
        list-style: none;
        display: flex;
        flex-wrap: wrap;
    }

    .breadcrumb-item {
        color: #64748B;
    }

    .breadcrumb-item + .breadcrumb-item::before {
        content: "/ ";
        color: #94A3B8;
        padding: 0 8px;
    }

    .breadcrumb-item.active {
        color: #1E293B;
        font-weight: 500;
    }

    .breadcrumb a {
        color: #3498db;
        text-decoration: none;
    }

    .section-container {
        background: white;
        border-radius: 8px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        margin-bottom: 24px;
        border: 1px solid #E2E8F0;
    }

    .page-header {
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid #F1F5F9;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 16px;
    }

    .page-title {
        font-size: 22px;
        font-weight: 600;
        color: #1E293B;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .btn-primary {
        padding: 10px 20px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary:hover {
        background: #2980b9;
        color: white;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }

    .stat-card {
        background: white;
        border: 1px solid #E2E8F0;
        border-radius: 8px;
        padding: 20px;
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #3498db, #2980b9);
    }

    .stat-label {
        font-size: 13px;
        font-weight: 600;
        color: #64748B;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #1E293B;
    }

    .search-section {
        background: white;
        border: 1px solid #E2E8F0;
        border-radius: 8px;
        padding: 16px 20px;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .search-input-wrapper {
        position: relative;
        flex: 1;
    }

    .search-icon {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: #94A3B8;
        font-size: 16px;
    }

    .search-input {
        width: 100%;
        padding: 12px 14px 12px 42px;
        border: 1px solid #E2E8F0;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: #F8FAFC;
    }

    .search-input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        background: white;
    }

    .search-btn {
        padding: 12px 24px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .search-btn:hover {
        background: #2980b9;
    }

    .roles-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .role-card {
        background: white;
        border: 1px solid #E2E8F0;
        border-radius: 8px;
        padding: 20px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .role-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }

    .role-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #3498db, #2980b9);
    }

    .role-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 12px;
    }

    .role-title {
        font-size: 18px;
        font-weight: 600;
        color: #1E293B;
        margin-bottom: 4px;
    }

    .role-status {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .role-status.active {
        background: #D1FAE5;
        color: #065F46;
    }

    .role-status.inactive {
        background: #FEE2E2;
        color: #991B1B;
    }

    .role-description {
        color: #64748B;
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 16px;
    }

    .role-meta {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 12px 0;
        border-top: 1px solid #F1F5F9;
        font-size: 13px;
        color: #64748B;
    }

    .role-meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .role-actions {
        display: flex;
        gap: 8px;
        margin-top: 12px;
    }

    .btn-action {
        flex: 1;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        border: 1px solid;
    }

    .btn-view {
        background: white;
        color: #3498db;
        border-color: #3498db;
    }

    .btn-view:hover {
        background: #3498db;
        color: white;
    }

    .btn-edit {
        background: white;
        color: #f39c12;
        border-color: #f39c12;
    }

    .btn-edit:hover {
        background: #f39c12;
        color: white;
    }

    .btn-delete {
        background: white;
        color: #e74c3c;
        border-color: #e74c3c;
    }

    .btn-delete:hover {
        background: #e74c3c;
        color: white;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-icon {
        font-size: 64px;
        color: #CBD5E1;
        margin-bottom: 16px;
    }

    .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 24px;
        padding-top: 20px;
        border-top: 1px solid #F1F5F9;
    }

    .pagination-info {
        color: #64748B;
        font-size: 14px;
    }

    .pagination {
        display: flex;
        gap: 5px;
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .page-link {
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 36px;
        height: 36px;
        padding: 0 12px;
        border: 1px solid #E2E8F0;
        border-radius: 6px;
        color: #64748B;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s ease;
        background: white;
    }

    .page-link:hover {
        background: #F8FAFC;
        border-color: #3498db;
        color: #3498db;
    }

    .page-item.active .page-link {
        background: #3498db;
        border-color: #3498db;
        color: white;
    }

    @media (max-width: 768px) {
        .roles-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'admin_dashboard' %}">
                    <i class="bi bi-house-door"></i> Dashboard
                </a>
            </li>
            <li class="breadcrumb-item">System</li>
            <li class="breadcrumb-item active">Roles</li>
        </ol>
    </nav>

    <div class="section-container">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1 class="page-title">
                    <i class="fas fa-shield-alt"></i>
                    Roles & Permissions
                </h1>
                <p style="color: #64748B; font-size: 14px; margin: 8px 0 0 0;">
                    Manage user roles and access control
                </p>
            </div>
            <a href="{% url 'role_create' %}" class="btn-primary">
                <i class="bi bi-plus-circle"></i>
                Create Role
            </a>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">
                    <i class="fas fa-shield-alt"></i>
                    Total Roles
                </div>
                <div class="stat-value">{{ stats.total|default:0|intcomma }}</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">
                    <i class="fas fa-check-circle"></i>
                    Active Roles
                </div>
                <div class="stat-value" style="color: #27ae60;">{{ stats.active|default:0|intcomma }}</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">
                    <i class="fas fa-ban"></i>
                    Inactive Roles
                </div>
                <div class="stat-value" style="color: #e74c3c;">{{ stats.inactive|default:0|intcomma }}</div>
            </div>
        </div>

        <!-- Search -->
        <div class="search-section">
            <form method="get" style="display: flex; align-items: center; gap: 12px; width: 100%;">
                <div class="search-input-wrapper">
                    <i class="bi bi-search search-icon"></i>
                    <input 
                        type="text" 
                        name="search" 
                        class="search-input" 
                        placeholder="Search roles by name or description..."
                        value="{{ search_query }}"
                    >
                </div>
                
                {% if current_is_active %}
                <input type="hidden" name="is_active" value="{{ current_is_active }}">
                {% endif %}
                
                <button type="submit" class="search-btn">
                    <i class="bi bi-search"></i>
                    Search
                </button>
            </form>
        </div>

        <!-- Roles Grid -->
        <div class="roles-grid">
            {% for role in page_obj %}
            <div class="role-card">
                <div class="role-header">
                    <div>
                        <h3 class="role-title">{{ role.name }}</h3>
                    </div>
                    <span class="role-status {% if role.is_active %}active{% else %}inactive{% endif %}">
                        {% if role.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                </div>
                
                <p class="role-description">
                    {{ role.description|truncatewords:20 }}
                </p>
                
                <div class="role-meta">
                    <div class="role-meta-item">
                        <i class="bi bi-people"></i>
                        <span>{{ role.user_count }} users</span>
                    </div>
                    <div class="role-meta-item">
                        <i class="bi bi-key"></i>
                        <span>{{ role.permissions.count }} permissions</span>
                    </div>
                </div>
                
                <div class="role-actions">
                    <a href="{% url 'role_detail' role.pk %}" class="btn-action btn-view">
                        <i class="bi bi-eye"></i>
                        View
                    </a>
                    <a href="{% url 'role_update' role.pk %}" class="btn-action btn-edit">
                        <i class="bi bi-pencil"></i>
                        Edit
                    </a>
                    <button onclick="confirmDelete({{ role.pk }}, '{{ role.name }}')" class="btn-action btn-delete">
                        <i class="bi bi-trash"></i>
                        Delete
                    </button>
                </div>
            </div>
            {% empty %}
            <div style="grid-column: 1 / -1;">
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3 style="color: #64748B; margin-bottom: 8px;">No Roles Found</h3>
                    <p style="color: #94A3B8;">
                        {% if search_query %}
                            No roles match your search.
                        {% else %}
                            Create your first role to get started.
                        {% endif %}
                    </p>
                    <a href="{% url 'role_create' %}" class="btn-primary" style="margin-top: 16px;">
                        <i class="bi bi-plus-circle"></i> Create First Role
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <div class="pagination-container">
            <div class="pagination-info">
                Showing {{ page_obj.start_index }} to {{ page_obj.end_index }} of {{ page_obj.paginator.count }} entries
            </div>
            
            <nav>
                <ul class="pagination">
                    {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}">{{ num }}</a>
                        </li>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function confirmDelete(roleId, roleName) {
        if (confirm(`Are you sure you want to delete role "${roleName}"? This action cannot be undone.`)) {
            window.location.href = `/roles/${roleId}/delete/`;
        }
    }
</script>
{% endblock %}