{% extends 'admin_base.html' %}
{% load humanize %}

{% block title %}Admin Dashboard - Wajir County ERP System{% endblock %}

{% block extra_css %}
<style>
    /* Statistics Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: 8px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border: 1px solid #E2E8F0;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
    }

    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .stat-icon.green {
        background: linear-gradient(135deg, #139145 0%, #0f7a38 100%);
        color: white;
    }

    .stat-icon.orange {
        background: linear-gradient(135deg, #C18B5A 0%, #a8754d 100%);
        color: white;
    }

    .stat-icon.blue {
        background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
        color: white;
    }

    .stat-icon.red {
        background: linear-gradient(135deg, #CD4F27 0%, #b33d1e 100%);
        color: white;
    }

    .stat-icon.purple {
        background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
        color: white;
    }

    .stat-icon.cyan {
        background: linear-gradient(135deg, #06B6D4 0%, #0891B2 100%);
        color: white;
    }

    .stat-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 12px;
        font-weight: 600;
        padding: 4px 10px;
        border-radius: 6px;
    }

    .stat-badge.green {
        color: #139145;
        background: rgba(19, 145, 69, 0.1);
    }

    .stat-badge.orange {
        color: #C18B5A;
        background: rgba(193, 139, 90, 0.1);
    }

    .stat-badge.red {
        color: #CD4F27;
        background: rgba(205, 79, 39, 0.1);
    }

    .stat-badge.blue {
        color: #3B82F6;
        background: rgba(59, 130, 246, 0.1);
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: #000000;
        margin-bottom: 4px;
        line-height: 1;
    }

    .stat-label {
        color: #0D6EFD;
        font-size: 14px;
        font-weight: 500;
    }

    /* Content Cards */
    .content-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        border: 1px solid #E2E8F0;
        margin-bottom: 24px;
    }

    .card-header-custom {
        padding: 20px 24px;
        border-bottom: 1px solid #E2E8F0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .card-title {
        font-size: 18px;
        font-weight: 600;
        color: #000000;
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 0;
    }

    .card-title i {
        color: #139145;
    }

    /* Chart Container */
    .chart-container {
        position: relative;
        padding: 24px;
        min-height: 300px;
    }

    .chart-container canvas {
        max-height: 400px;
    }

    /* Tables */
    .table-custom {
        width: 100%;
        margin: 0;
    }

    .table-custom thead th {
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #0D6EFD;
        border-bottom: 2px solid #E2E8F0;
        padding: 16px 24px;
        background: #F8FAFC;
    }

    .table-custom tbody td {
        padding: 16px 24px;
        vertical-align: middle;
        border-bottom: 1px solid #F1F5F9;
        color: #000000;
        font-size: 14px;
    }

    .table-custom tbody tr:hover {
        background-color: #F8FAFC;
    }

    /* Status Badges */
    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
    }

    .status-badge.completed {
        background: rgba(19, 145, 69, 0.1);
        color: #139145;
    }

    .status-badge.pending {
        background: rgba(193, 139, 90, 0.1);
        color: #C18B5A;
    }

    .status-badge.overdue {
        background: rgba(205, 79, 39, 0.1);
        color: #CD4F27;
    }

    .status-badge.active {
        background: rgba(59, 130, 246, 0.1);
        color: #3B82F6;
    }

    /* Grid Layout */
    .grid-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 24px;
    }

    .grid-layout-thirds {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
        margin-bottom: 24px;
    }

    /* Alert Boxes */
    .alert-box {
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .alert-box.warning {
        background: rgba(193, 139, 90, 0.1);
        border: 1px solid #C18B5A;
        color: #0D6EFD;
    }

    .alert-box.info {
        background: rgba(19, 145, 69, 0.1);
        border: 1px solid #139145;
        color: #0f7a38;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .grid-layout, .grid-layout-thirds {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Chart.js default configuration with Wajir colors
    Chart.defaults.font.family = "'Inter', sans-serif";
    Chart.defaults.color = '#0D6EFD';
    
    const wajirColors = {
        green: '#139145',
        orange: '#C18B5A',
        red: '#CD4F27',
        blue: '#3B82F6',
        purple: '#8B5CF6',
        cyan: '#06B6D4'
    };
    
    // 1. Monthly Revenue Trend (Smooth Line Chart)
    const revenueData = {{ revenue_chart_data|safe }};
    if (document.getElementById('revenueChart')) {
        new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: {
                labels: revenueData.labels,
                datasets: [{
                    label: 'Revenue (KES)',
                    data: revenueData.data,
                    borderColor: wajirColors.green,
                    backgroundColor: 'rgba(19, 145, 69, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3,
                    pointRadius: 5,
                    pointBackgroundColor: wajirColors.green
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: { 
                        beginAtZero: true, 
                        grid: { color: '#F1F5F9' },
                        ticks: {
                            callback: function(value) {
                                return 'KES ' + value.toLocaleString();
                            }
                        }
                    },
                    x: { grid: { display: false } }
                }
            }
        });
    }
    
    // 2. Revenue by Stream (Donut Chart)
    const streamData = {{ revenue_stream_chart|safe }};
    if (document.getElementById('streamChart')) {
        new Chart(document.getElementById('streamChart'), {
            type: 'doughnut',
            data: {
                labels: streamData.labels,
                datasets: [{
                    data: streamData.data,
                    backgroundColor: streamData.colors,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 15, font: { size: 12 } }
                    }
                }
            }
        });
    }
    
    // 3. Bills Status (Pie Chart)
    const billData = {{ bill_status_chart|safe }};
    if (document.getElementById('billChart')) {
        new Chart(document.getElementById('billChart'), {
            type: 'pie',
            data: {
                labels: billData.labels,
                datasets: [{
                    data: billData.data,
                    backgroundColor: billData.colors,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 15, font: { size: 12 } }
                    }
                }
            }
        });
    }
    
    // 4. Daily Revenue (Area Chart - Last 30 Days)
    const dailyData = {{ daily_revenue_chart|safe }};
    if (document.getElementById('dailyChart')) {
        new Chart(document.getElementById('dailyChart'), {
            type: 'line',
            data: {
                labels: dailyData.labels,
                datasets: [{
                    label: 'Daily Revenue',
                    data: dailyData.data,
                    borderColor: wajirColors.orange,
                    backgroundColor: 'rgba(193, 139, 90, 0.2)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { 
                        beginAtZero: true, 
                        grid: { color: '#F1F5F9' },
                        ticks: {
                            callback: function(value) {
                                return 'KES ' + value.toLocaleString();
                            }
                        }
                    },
                    x: { grid: { display: false } }
                }
            }
        });
    }
    
    // 5. Revenue by Sub-County (Bar Chart)
    const subcountyData = {{ subcounty_chart|safe }};
    if (document.getElementById('subcountyChart')) {
        new Chart(document.getElementById('subcountyChart'), {
            type: 'bar',
            data: {
                labels: subcountyData.labels,
                datasets: [{
                    label: 'Revenue',
                    data: subcountyData.data,
                    backgroundColor: wajirColors.green,
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { 
                        beginAtZero: true, 
                        grid: { color: '#F1F5F9' },
                        ticks: {
                            callback: function(value) {
                                return 'KES ' + value.toLocaleString();
                            }
                        }
                    },
                    x: { grid: { display: false } }
                }
            }
        });
    }
    
    // 6. Patient Visits Trend (Line Chart)
    const patientData = {{ patient_chart|safe }};
    if (document.getElementById('patientChart')) {
        new Chart(document.getElementById('patientChart'), {
            type: 'line',
            data: {
                labels: patientData.labels,
                datasets: [{
                    label: 'Visits',
                    data: patientData.data,
                    borderColor: wajirColors.blue,
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: { beginAtZero: true, grid: { color: '#F1F5F9' } },
                    x: { grid: { display: false } }
                }
            }
        });
    }
    
    // 7. License Status (Donut Chart)
    const licenseData = {{ license_chart|safe }};
    if (document.getElementById('licenseChart')) {
        new Chart(document.getElementById('licenseChart'), {
            type: 'doughnut',
            data: {
                labels: licenseData.labels,
                datasets: [{
                    data: licenseData.data,
                    backgroundColor: licenseData.colors,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 15, font: { size: 12 } }
                    }
                }
            }
        });
    }
    
    // 8. Fleet Fuel Costs (Bar Chart)
    const fuelData = {{ fuel_chart|safe }};
    if (document.getElementById('fuelChart')) {
        new Chart(document.getElementById('fuelChart'), {
            type: 'bar',
            data: {
                labels: fuelData.labels,
                datasets: [{
                    label: 'Fuel Cost (KES)',
                    data: fuelData.data,
                    backgroundColor: wajirColors.red,
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { 
                        beginAtZero: true, 
                        grid: { color: '#F1F5F9' },
                        ticks: {
                            callback: function(value) {
                                return 'KES ' + value.toLocaleString();
                            }
                        }
                    },
                    x: { grid: { display: false } }
                }
            }
        });
    }
    
    // 9. Payment Methods (Pie Chart)
    const methodData = {{ payment_method_chart|safe }};
    if (document.getElementById('methodChart')) {
        new Chart(document.getElementById('methodChart'), {
            type: 'pie',
            data: {
                labels: methodData.labels,
                datasets: [{
                    data: methodData.data,
                    backgroundColor: methodData.colors,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 15, font: { size: 12 } }
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1 class="page-title">Dashboard Overview</h1>
    <div class="breadcrumb">
        <a href="#">Home</a>
        <span>/</span>
        <span>Dashboard</span>
    </div>
</div>

<!-- Alert Boxes -->
{% if overdue_bills_count > 0 %}
<div class="alert-box warning">
    <i class="bi bi-exclamation-triangle" style="font-size: 24px;"></i>
    <div>
        <strong>Overdue Bills:</strong> {{ overdue_bills_count }} bill{{ overdue_bills_count|pluralize }} {{ overdue_bills_count|pluralize:"is,are" }} overdue.
        <a href="#" style="color: inherit; text-decoration: underline;">View Details</a>
    </div>
</div>
{% endif %}

{% if expiring_licenses > 0 %}
<div class="alert-box info">
    <i class="bi bi-calendar-check" style="font-size: 24px;"></i>
    <div>
        <strong>Expiring Licenses:</strong> {{ expiring_licenses }} license{{ expiring_licenses|pluralize }} expiring within 30 days.
        <a href="#" style="color: inherit; text-decoration: underline;">View Details</a>
    </div>
</div>
{% endif %}

<!-- Main Statistics Cards -->
<div class="stats-grid">
    <!-- Total Revenue -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon green">
                <i class="bi bi-cash-stack"></i>
            </div>
            <div class="stat-badge green">
                <i class="bi bi-arrow-up"></i> Total
            </div>
        </div>
        <div class="stat-value">KES {{ total_revenue|floatformat:0|intcomma }}</div>
        <div class="stat-label">Total Revenue Collected</div>
    </div>

    <!-- Outstanding Bills -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon red">
                <i class="bi bi-wallet2"></i>
            </div>
            <div class="stat-badge red">
                <i class="bi bi-exclamation-circle"></i> Outstanding
            </div>
        </div>
        <div class="stat-value">KES {{ outstanding_amount|floatformat:0|intcomma }}</div>
        <div class="stat-label">Outstanding Bills</div>
    </div>

    <!-- Paid Bills -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon blue">
                <i class="bi bi-credit-card"></i>
            </div>
            <div class="stat-badge blue">
                <i class="bi bi-check-circle"></i> Paid
            </div>
        </div>
        <div class="stat-value">{{ paid_bills|intcomma }}</div>
        <div class="stat-label">Paid Bills</div>
    </div>

    <!-- Active Licenses -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon orange">
                <i class="bi bi-certificate"></i>
            </div>
            <div class="stat-badge orange">
                <i class="bi bi-award"></i> Active
            </div>
        </div>
        <div class="stat-value">{{ active_licenses|intcomma }}</div>
        <div class="stat-label">Active Business Licenses</div>
    </div>

    <!-- Total Citizens -->
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon purple">
                <i class="bi bi-people"></i>
            </div>
            <div class="stat-badge" style="background: rgba(139, 92, 246, 0.1); color: #8B5CF6;">
                <i class="bi bi-person-check"></i> Registered
            </div>
        </div>
        <div class="stat-value">{{ total_citizens|intcomma }}</div>
        <div class="stat-label">Registered Citizens</div>
    </div>
</div>




<!-- Main Revenue Trend Chart -->
<div class="content-card">
    <div class="card-header-custom">
        <h6 class="card-title">
            <i class="bi bi-graph-up"></i>
            Revenue Trend (Last 6 Months)
        </h6>
    </div>
    <div class="chart-container" style="min-height: 350px;">
        <canvas id="revenueChart"></canvas>
    </div>
</div>

<!-- Revenue Analysis Charts -->
<div class="grid-layout">
    <!-- Revenue by Stream -->
    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-pie-chart"></i>
                Revenue by Stream
            </h6>
        </div>
        <div class="chart-container">
            <canvas id="streamChart"></canvas>
        </div>
    </div>

    <!-- Bills Status -->
    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-file-earmark-check"></i>
                Bills Status Distribution
            </h6>
        </div>
        <div class="chart-container">
            <canvas id="billChart"></canvas>
        </div>
    </div>
</div>

<!-- Daily Revenue Trend -->
<div class="content-card">
    <div class="card-header-custom">
        <h6 class="card-title">
            <i class="bi bi-calendar-day"></i>
            Daily Revenue Trend (Last 30 Days)
        </h6>
    </div>
    <div class="chart-container" style="min-height: 350px;">
        <canvas id="dailyChart"></canvas>
    </div>
</div>

<!-- Sub-County Revenue & Patient Visits -->
<div class="grid-layout">
    <!-- Revenue by Sub-County -->
    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-map"></i>
                Revenue by Sub-County (Top 10)
            </h6>
        </div>
        <div class="chart-container" style="min-height: 400px;">
            <canvas id="subcountyChart"></canvas>
        </div>
    </div>

    <!-- Patient Visits Trend -->
    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-activity"></i>
                Patient Visits Trend
            </h6>
        </div>
        <div class="chart-container" style="min-height: 400px;">
            <canvas id="patientChart"></canvas>
        </div>
    </div>
</div>

<!-- Three Column Charts -->
<div class="grid-layout-thirds">
    <!-- License Status -->
    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-award"></i>
                License Status
            </h6>
        </div>
        <div class="chart-container">
            <canvas id="licenseChart"></canvas>
        </div>
    </div>

    <!-- Fleet Fuel Costs -->
    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-fuel-pump-fill"></i>
                Fuel Costs (Top 10)
            </h6>
        </div>
        <div class="chart-container">
            <canvas id="fuelChart"></canvas>
        </div>
    </div>

    <!-- Payment Methods -->
    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-credit-card-2-front"></i>
                Payment Methods
            </h6>
        </div>
        <div class="chart-container">
            <canvas id="methodChart"></canvas>
        </div>
    </div>
</div>

<!-- Recent Payments Table -->
<div class="content-card">
    <div class="card-header-custom">
        <h6 class="card-title">
            <i class="bi bi-clock-history"></i>
            Recent Payments
        </h6>
        <a href="#" class="btn btn-sm btn-outline-success">
            <i class="bi bi-eye"></i> View All
        </a>
    </div>
    <div class="table-responsive">
        <table class="table-custom">
            <thead>
                <tr>
                    <th>Receipt No.</th>
                    <th>Payer</th>
                    <th>Revenue Stream</th>
                    <th>Method</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in recent_payments %}
                <tr>
                    <td>
                        <span style="color: #139145; font-weight: 600;">
                            {{ payment.receipt_number }}
                        </span>
                    </td>
                    <td style="font-weight: 500;">{{ payment.payer_name }}</td>
                    <td style="font-weight: 500;">{{ payment.revenue_stream.name|truncatewords:4 }}</td>
                    <td>
                        <span class="status-badge active">
                            {{ payment.payment_method.name }}
                        </span>
                    </td>
                    <td style="font-weight: 600; color: #139145;">
                        KES {{ payment.amount|floatformat:0|intcomma }}
                    </td>
                    <td>
                        {% if payment.status == 'completed' %}
                            <span class="status-badge completed">
                                <i class="bi bi-check-circle"></i> Completed
                            </span>
                        {% elif payment.status == 'pending' %}
                            <span class="status-badge pending">
                                <i class="bi bi-clock"></i> Pending
                            </span>
                        {% elif payment.status == 'failed' %}
                            <span class="status-badge overdue">
                                <i class="bi bi-x-circle"></i> Failed
                            </span>
                        {% else %}
                            <span class="status-badge">{{ payment.get_status_display }}</span>
                        {% endif %}
                    </td>
                    <td style="color: #0D6EFD; font-size: 13px;">
                        {{ payment.payment_date|date:"M d, Y H:i" }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7">
                        <div style="text-align: center; padding: 48px 24px;">
                            <i class="bi bi-inbox" style="font-size: 48px; color: #CBD5E1;"></i>
                            <p style="color: #0D6EFD; font-size: 14px; margin: 16px 0 0 0;">No recent payments</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Recent Bills Table -->
<div class="content-card">
    <div class="card-header-custom">
        <h6 class="card-title">
            <i class="bi bi-file-earmark-text"></i>
            Recent Bills
        </h6>
        <a href="#" class="btn btn-sm btn-outline-success">
            <i class="bi bi-eye"></i> View All
        </a>
    </div>
    <div class="table-responsive">
        <table class="table-custom">
            <thead>
                <tr>
                    <th>Bill Number</th>
                    <th>Citizen</th>
                    <th>Revenue Stream</th>
                    <th>Bill Amount</th>
                    <th>Balance</th>
                    <th>Status</th>
                    <th>Due Date</th>
                </tr>
            </thead>
            <tbody>
                {% for bill in recent_bills %}
                <tr>
                    <td>
                        <span style="color: #139145; font-weight: 600;">
                            {{ bill.bill_number }}
                        </span>
                    </td>
                    <td style="font-weight: 500;">
                        {% if bill.citizen.entity_type == 'individual' %}
                            {{ bill.citizen.first_name }} {{ bill.citizen.last_name }}
                        {% else %}
                            {{ bill.citizen.business_name }}
                        {% endif %}
                    </td>
                    <td style="font-weight: 500;">{{ bill.revenue_stream.name|truncatewords:4 }}</td>
                    <td style="font-weight: 600; color: #000000;">
                        KES {{ bill.bill_amount|floatformat:0|intcomma }}
                    </td>
                    <td style="font-weight: 600; color: #CD4F27;">
                        KES {{ bill.balance|floatformat:0|intcomma }}
                    </td>
                    <td>
                        {% if bill.status == 'paid' %}
                            <span class="status-badge completed">
                                <i class="bi bi-check-circle"></i> Paid
                            </span>
                        {% elif bill.status == 'partially_paid' %}
                            <span class="status-badge pending">
                                <i class="bi bi-clock"></i> Partial
                            </span>
                        {% elif bill.status == 'overdue' %}
                            <span class="status-badge overdue">
                                <i class="bi bi-exclamation-triangle"></i> Overdue
                            </span>
                        {% elif bill.status == 'issued' %}
                            <span class="status-badge active">
                                <i class="bi bi-file-text"></i> Issued
                            </span>
                        {% else %}
                            <span class="status-badge">{{ bill.get_status_display }}</span>
                        {% endif %}
                    </td>
                    <td style="color: #0D6EFD; font-size: 13px;">
                        {{ bill.due_date|date:"M d, Y" }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7">
                        <div style="text-align: center; padding: 48px 24px;">
                            <i class="bi bi-inbox" style="font-size: 48px; color: #CBD5E1;"></i>
                            <p style="color: #0D6EFD; font-size: 14px; margin: 16px 0 0 0;">No recent bills</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Quick Stats Summary -->
<div class="grid-layout">
    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-hospital"></i>
                Health Services Summary
            </h6>
        </div>
        <div style="padding: 24px;">
            <div class="stats-grid" style="margin-bottom: 0;">
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Total Patients</div>
                    <div style="font-size: 24px; font-weight: 700; color: #000000;">
                        {{ total_patients|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Visits Today</div>
                    <div style="font-size: 24px; font-weight: 700; color: #139145;">
                        {{ visits_today|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Active Admissions</div>
                    <div style="font-size: 24px; font-weight: 700; color: #CD4F27;">
                        {{ active_admissions|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Pending Lab Tests</div>
                    <div style="font-size: 24px; font-weight: 700; color: #C18B5A;">
                        {{ pending_lab_tests|intcomma }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-people"></i>
                Human Resource Summary
            </h6>
        </div>
        <div style="padding: 24px;">
            <div class="stats-grid" style="margin-bottom: 0;">
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Total Employees</div>
                    <div style="font-size: 24px; font-weight: 700; color: #000000;">
                        {{ total_employees|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Present Today</div>
                    <div style="font-size: 24px; font-weight: 700; color: #139145;">
                        {{ present_today|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Pending Leaves</div>
                    <div style="font-size: 24px; font-weight: 700; color: #C18B5A;">
                        {{ pending_leaves|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Attendance Rate</div>
                    <div style="font-size: 24px; font-weight: 700; color: #3B82F6;">
                        {% if total_employees > 0 %}
                            {% widthratio present_today total_employees 100 %}%
                        {% else %}
                            0%
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Assets & Fleet Summary -->
<div class="grid-layout">
    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-truck"></i>
                Fleet Management Summary
            </h6>
        </div>
        <div style="padding: 24px;">
            <div class="stats-grid" style="margin-bottom: 0;">
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Active Vehicles</div>
                    <div style="font-size: 24px; font-weight: 700; color: #139145;">
                        {{ total_vehicles_fleet|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Under Maintenance</div>
                    <div style="font-size: 24px; font-weight: 700; color: #CD4F27;">
                        {{ vehicles_maintenance|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Fuel Cost (Month)</div>
                    <div style="font-size: 24px; font-weight: 700; color: #C18B5A;">
                        {{ fuel_cost_month|floatformat:0|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Total Assets</div>
                    <div style="font-size: 24px; font-weight: 700; color: #3B82F6;">
                        {{ total_assets|intcomma }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="content-card">
        <div class="card-header-custom">
            <h6 class="card-title">
                <i class="bi bi-building"></i>
                Property & Services Summary
            </h6>
        </div>
        <div style="padding: 24px;">
            <div class="stats-grid" style="margin-bottom: 0;">
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Total Properties</div>
                    <div style="font-size: 24px; font-weight: 700; color: #000000;">
                        {{ total_properties|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Active Licenses</div>
                    <div style="font-size: 24px; font-weight: 700; color: #139145;">
                        {{ active_licenses|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Registered Vehicles</div>
                    <div style="font-size: 24px; font-weight: 700; color: #3B82F6;">
                        {{ total_vehicles|intcomma }}
                    </div>
                </div>
                <div>
                    <div style="color: #0D6EFD; font-size: 13px; margin-bottom: 8px;">Expired Licenses</div>
                    <div style="font-size: 24px; font-weight: 700; color: #CD4F27;">
                        {{ expired_licenses|intcomma }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}